<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="SRE(SmartReading-English)是提供臺灣等英語學習者閱讀英語讀本的學習平臺。SRE透過閱讀能力檢測對學習者進行英語閱讀能力評估後，再運用AI技術將學習者的英語閱讀程度和文本難度進行適性配對，並推薦適合學習者閱讀能力的英語讀本，增加學習者對英語閱讀的樂趣。當學習者閱讀文本後，可透過讀後測驗，了解自己對文本的理解程度。" />
    <title>SmartReading-English</title>
    <link rel="shortcut icon" type="image/x-icon" href="image/favicon.ico">

    <!-- this page widgets CSS -->
    <!-- modal -->
    <link rel="stylesheet" href="css/jquery.modal.min.css" />

    <link rel="stylesheet" href="css/fontawesome-free-6.1.1-web.min.css">

    <!-- my core CSS -->
    <link rel="stylesheet" type="text/css" href="css/SREstyles.css">
</head>

<body>
    <header class="header">
    </header>
    <!-- <div class="slide">
    <img src="image/photo/slide/slide_booklist_1.png" alt="">
  </div> -->
    <div class="main studio">
        <div class="tittle">
            <h1>創作室 Studio</h1>
        </div>

        <div class="studio_area">
            <div class="studio_content_area">

                <div class="studio_content_area_item">
                    <div class="studio_content_title">
                        <h4>
                            聲畫室 Sound & Sketch Room
                        </h4>
                    </div>

                    <div class="studio_content_item">
                        <div class="studio_content_item_frame">
                            <div class="studio_content_item_frame_content">
                                <div class="studio_content_item_frame_content_illustrate">
                                    <div class="svg_icon">
                                        <div class="sound_bar_area">
                                            <!-- 播放時class加上"play_animation" -->
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                        </div>

                                        <p>
                                            <i class="fa-solid fa-microphone-lines"></i>
                                        </p>

                                        <div class="sound_bar_area">
                                            <!-- 播放時class加上"play_animation" -->
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                            <div class="bar"></div>
                                        </div>
                                    </div>


                                    <p>
                                        將你的創作化為聲音記錄下來吧！
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="studio_content_item_btn">
                            <button id="Btn_record" atwork="0" class="studio_function_btn record_area_item">
                                <div class="studio_btn_icon">
                                    <i class="fa-solid fa-microphone-lines"></i>
                                </div>

                                <div class="studio_btn_text">
                                    <p id="recordText">錄製聲音</p>
                                    <p id="recordTextEnglish">Voice recording</p>
                                </div>
                            </button>

                            <button id="Btn_playRec" disabled="disabled" class="studio_function_btn play_area_item">
                                <div class="studio_btn_icon">
                                    <i class="fa-solid fa-play"></i>
                                </div>

                                <div class="studio_btn_text">
                                    <p id="playText">播放錄音</p>
                                    <p id="playTextEnglish">Play recording</p>
                                </div>
                            </button>

                            <button class="studio_text_submit" type="submit">
                                <p>
                                    送出
                                </p>
                            </button>
                        </div>

                    </div>

                    <div class="studio_content_item">
                        <div class="studio_content_item_frame">
                            <div id="paintHeight" class="studio_content_item_frame_content">
                                <div id="paintWidth" class="studio_content_item_frame_content_illustrate paint">

                                    <!-- <div class="upload_paint">
                                        <div class="upload_paint_area">
                                            
                                        </div>
                                    </div> -->

                                    <div id="canvas_review" class="upload_paint_area_answer" style="display: none;">
                                        <img src="" alt="" class="canvasImg" id="canvasImg">
                                    </div>


                                    <div class="svg_icon">
                                        <p>
                                            <i class="fa-solid fa-palette"></i>
                                        </p>
                                    </div>
                                    <p>
                                        將你的創作化為圖畫記錄下來吧！
                                    </p>


                                </div>
                            </div>
                        </div>

                        <div class="studio_content_item_btn">
                            <a href="#div_palette" rel="modal:open" onclick="OpenPalette()" class="studio_function_btn">
                                <div class="studio_btn_icon">
                                    <i class="fa-solid fa-paintbrush"></i>
                                </div>
                                <div class="studio_btn_text">
                                    <p class="studio_btn_text_play_tw">開始繪畫</p>
                                    <p class="studio_btn_text_play_en">painting</p>
                                </div>
                            </a>

                            <button class="studio_text_submit" type="submit">
                                <p>
                                    送出
                                </p>
                            </button>
                        </div>


                    </div>

                </div>

            </div>
        </div>
    </div>

    <div class="modal studio_modal studio_palette_modal" id="div_palette" style="display: block !important;">
        <div class="modal_content">
            <div class="modal-header">
                <h4 id="h4_title" class="modal-title">繪圖面板</h4>
            </div>
            <div class="modal-body">
                <div class="draw-panel">
                    <div class="draw-panel-left">
                        <div class="draw-panel-left-item draw-panel-left-item-tool">
                            <div class="draw-panel-left-item-text">
                                <p id="h5_1">工具</p>
                            </div>
                            <div class="draw-panel-left-item-btn">
                                <button id="drawMode_1" class="draw-panel-btn btn-draw-tool active" type="button"
                                    onclick="drawMode(1)">
                                    <i class="fa fa-pencil fa-lg" aria-hidden="true"></i>
                                </button>

                                <button id="drawMode_0" class="draw-panel-btn btn-draw-tool" type="button"
                                    onclick="drawMode(0)">
                                    <i class="fa fa-eraser fa-lg" aria-hidden="true"></i>
                                </button>

                                <button id="btn_undo" class="draw-panel-btn btn-draw-tool" type="button"
                                    disabled="disabled" onclick="undo()">
                                    <i class="fa fa-reply" aria-hidden="true"></i>
                                </button>

                                <button id="btn_redo" class="draw-panel-btn btn-draw-tool" type="button"
                                    disabled="disabled" onclick="redo()">
                                    <i class="fa fa-share" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>

                        <div class="draw-panel-left-item draw-panel-left-item-size">
                            <div class="draw-panel-left-item-text">
                                <p id="h5_2">筆畫</p>
                            </div>
                            <div class="draw-panel-left-item-btn">
                                <button id="size_0" class="draw-panel-btn btn-draw-size" type="button"
                                    onclick="drawSize(2,0)">
                                    <span class="draw-size" style="height:2px;"></span>
                                </button>

                                <button id="size_1" class="draw-panel-btn btn-draw-size" type="button"
                                    onclick="drawSize(5,1)">
                                    <span class="draw-size" style="height:5px;"></span>
                                </button>

                                <button id="size_2" class="draw-panel-btn btn-draw-size" type="button"
                                    onclick="drawSize(7,2)">
                                    <span class="draw-size" style="height:7px;"></span>
                                </button>

                                <button id="size_3" class="draw-panel-btn btn-draw-size active" type="button"
                                    onclick="drawSize(9,3)">
                                    <span class="draw-size" style="height:9px;"></span>
                                </button>
                            </div>
                        </div>

                        <div class="draw-panel-left-item draw-panel-left-item-color">
                            <div class="draw-panel-left-item-text">
                                <p id="h5_3">顏色</p>
                            </div>
                            <div class="draw-panel-left-item-btn">
                                <button id="color_0" class="draw-panel-btn btn-draw-color active" type="button"
                                    onclick="drawColor('#000',0)">
                                    <span class="draw-color" style="background-color: #000;"></span>
                                </button>

                                <button id="color_1" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#FFF',1)">
                                    <span class="draw-color" style="background-color: #FFF;"></span>
                                </button>

                                <button id="color_2" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#666',2)">
                                    <span class="draw-color" style="background-color: #666;"></span>
                                </button>

                                <button id="color_3" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#CCC',3)">
                                    <span class="draw-color" style="background-color: #CCC;"></span>
                                </button>

                                <button id="color_4" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#900',4)">
                                    <span class="draw-color" style="background-color: #900;"></span>
                                </button>

                                <button id="color_5" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#C90',5)">
                                    <span class="draw-color" style="background-color: #C90;"></span>
                                </button>

                                <button id="color_6" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#F00',6)">
                                    <span class="draw-color" style="background-color: #F00;"></span>
                                </button>

                                <button id="color_7" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#FCC',7)">
                                    <span class="draw-color" style="background-color: #FCC;"></span>
                                </button>

                                <button id="color_8" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#F63',8)">
                                    <span class="draw-color" style="background-color: #F63;"></span>
                                </button>

                                <button id="color_9" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#FC0',9)">
                                    <span class="draw-color" style="background-color: #FC0;"></span>
                                </button>

                                <button id="color_10" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#FF0',10)">
                                    <span class="draw-color" style="background-color: #FF0;"></span>
                                </button>

                                <button id="color_11" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#FFC',11)">
                                    <span class="draw-color" style="background-color: #FFC;"></span>
                                </button>

                                <button id="color_12" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#393',12)">
                                    <span class="draw-color" style="background-color: #393;"></span>
                                </button>

                                <button id="color_13" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#CF3',13)">
                                    <span class="draw-color" style="background-color: #CF3;"></span>
                                </button>

                                <button id="color_14" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#09F',14)">
                                    <span class="draw-color" style="background-color: #09F;"></span>
                                </button>

                                <button id="color_15" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#9CF',15)">
                                    <span class="draw-color" style="background-color: #9CF;"></span>
                                </button>

                                <button id="color_16" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#33C',16)">
                                    <span class="draw-color" style="background-color: #33C;"></span>
                                </button>

                                <button id="color_17" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#69C',17)">
                                    <span class="draw-color" style="background-color: #69C;"></span>
                                </button>

                                <button id="color_18" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#939',18)">
                                    <span class="draw-color" style="background-color: #939;"></span>
                                </button>

                                <button id="color_19" class="draw-panel-btn btn-draw-color" type="button"
                                    onclick="drawColor('#CCF',19)">
                                    <span class="draw-color" style="background-color: #CCF;"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="div_draw" class="draw-panel-right">
                        <!--  隨意畫-->
                        <canvas id="myCanvas" width="415" height="280" style="display:block">
                        </canvas>
                        <!-- 隨意畫-->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn_clean" class="draw-panel-footer-btn" onclick="clenCanvas()">
                    <p>
                        清空
                    </p>
                </button>
                <a href="#close-modal" rel="modal:close" class="draw-panel-footer-btn" onclick="saveDraw()">
                        完成
                </a>
            </div>
        </div>

    </div>

    <footer>
    </footer>

    <script src="js/jquery-3.6.1.min.js"></script>

    <!-- modal -->
    <script src="js/jquery.modal.min.js"></script>

    <script src="js/fontawesome-free-6.1.1.min.js"></script>
    <script src="js/all.js"></script>


    <script>
        $(document).ready(function () {
            $('header').load('header_login.html', function () {});
            $('footer').load('footer.html', function () {});
        });
    </script>

    <script>
        var scrollToHeight = $(".book_area_menu").height();
        $(".scrollTo").click(function () {
            $("html, body").animate({
                scrollTop: $($(this).attr("href")).offset().top - scrollToHeight
            }, 500);
            return false;
        });
    </script>

    <!-- 錄音功能 -->
    <script>
        //點選錄製聲音跟播放顯示聲音動態
        $(".record_area_item").click(function () {
            $(".sound_bar_area").toggleClass("play_animation");
            if ($(this).children('.studio_btn_icon').children('i').hasClass("fa-microphone-lines")) { //原本是播放
                $(this).children('.studio_btn_icon').children('i').addClass("fa-stop");
                $(this).children('.studio_btn_icon').children('i').removeClass("fa-microphone-lines");
                $(".listen_sentence_btn").attr("disabled", true);
                $(".play_area_item").attr("disabled", true);
                $(this).addClass("active");
            } else { //原本是停止
                $(this).children('.studio_btn_icon').children('i').addClass("fa-microphone-lines");
                $(this).children('.studio_btn_icon').children('i').removeClass("fa-stop");
                $(".listen_sentence_btn").attr("disabled", false);
                $(".play_area_item").attr("disabled", false);
                $(this).removeClass("active");
            }

            var recordText = document.getElementById("recordText");
            if (recordText.innerHTML === "停止錄製") {
                recordText.innerHTML = "錄製聲音";
            } else {
                recordText.innerHTML = "停止錄製";
            }

            var recordTextEnglish = document.getElementById("recordTextEnglish");
            if (recordTextEnglish.innerHTML === "Stop recording") {
                recordTextEnglish.innerHTML = "Voice recording";
            } else {
                recordTextEnglish.innerHTML = "Stop recording";
            }
        });

        //點選播放跟播放顯示聲音動態
        $(".play_area_item").click(function () {
            $(".sound_bar_area").toggleClass("play_animation");
            if ($(this).children('.studio_btn_icon').children('i').hasClass("fa-play")) { //原本是播放
                $(this).children('.studio_btn_icon').children('i').addClass("fa-stop");
                $(this).children('.studio_btn_icon').children('i').removeClass("fa-play");
                $(".record_area_item").attr("disabled", true);
                $(".listen_sentence_btn").attr("disabled", true);
                $(this).addClass("active");
            } else { //原本是停止
                $(this).children('.studio_btn_icon').children('i').addClass("fa-play");
                $(this).children('.studio_btn_icon').children('i').removeClass("fa-stop");
                $(".record_area_item").attr("disabled", false);
                $(".listen_sentence_btn").attr("disabled", false);
                $(this).removeClass("active");
            }

            var playText = document.getElementById("playText");
            if (playText.innerHTML === "停止錄音") {
                playText.innerHTML = "播放錄音";
            } else {
                playText.innerHTML = "停止錄音";
            }

            var playTextEnglish = document.getElementById("playTextEnglish");
            if (playTextEnglish.innerHTML === "Stop recording") {
                playTextEnglish.innerHTML = "Play recording";
            } else {
                playTextEnglish.innerHTML = "Stop recording";
            }
        });
    </script>

    <!--塗鴉-->

    <!-- 測試用 -->
    <script>
        $(document).ready(function () {
            paintHandler();
            recordStep();
            sigCanvas.width = $("#div_draw").width(); //重新設定畫布寬度
            sigCanvas.height = $("#div_draw").height(); //重新設定畫布高度
        });
    </script>
    <!-- 測試用 -->

    <script>
        var isPen = 1; //是否塗鴉模式：1(是)、0(否，橡皮擦)
        var size = 9; //塗鴉尺寸：預設9px
        var color = "#000"; //塗鴉顏色：預設#CCF
        var draw_index; //紀錄繪圖的題序索引，以便繪圖上傳預覽使用。

        //打開繪圖面板
        function OpenPalette() {
            // $("main").fadeOut();
            // $("#div_palette").fadeIn();
            //重設畫布
            // resetCanvas();

        }

        //塗鴉模式(工具)
        function drawMode(_isPen) {
            isPen = _isPen
            //console.log("塗鴉模式：" + isPen);

            //拿掉按鈕外框
            for (var i = 0; i <= 1; i++) {
                $("#drawMode_" + i).removeClass("active");
            }
            //所選工具，其按鈕加上外框
            $("#drawMode_" + _isPen).addClass("active");

        }

        //塗鴉尺寸
        function drawSize(_size, _index) {
            size = _size;
            //console.log("塗鴉尺寸：" + size);

            //拿掉按鈕外框
            for (var i = 0; i < 4; i++) {
                $("#size_" + i).removeClass("active");
            }
            //所選顏色，其按鈕加上外框
            $("#size_" + _index).addClass("active");
        }

        //塗鴉顏色
        function drawColor(_color, _index) {
            color = _color;
            //console.log("塗鴉顏色：" + color);

            //拿掉按鈕外框
            for (var i = 0; i < 20; i++) {
                $("#color_" + i).removeClass("active");
            }
            //所選顏色，其按鈕加上外框
            $("#color_" + _index).addClass("active");
        }

        //塗鴉存檔
        function saveDraw() {
            hasPaint = true; //標記為有畫圖，或有上傳圖片

            var imageData = step_arr[step_index];

            $("#canvas_review").addClass("open");

            var paintH = document.getElementById("paintHeight");
            var paintW = document.getElementById("paintWidth");
            var paintHeight = $("#div_draw").height() + "px";
            var paintWidth = $("#div_draw").width() + "px";

            paintH.style.height = paintHeight;
            paintW.style.width = paintWidth;

            var canvasImgURL = sigCanvas.toDataURL("image/png");
            
            var canvasImg = document.getElementById("canvasImg");
            canvasImg.src = canvasImgURL;

            

            // var scale = 1;
            //若圖片寬度超過，按比率縮小
            // if ($(sigCanvas).width() <= viewCanvas.width) {

            //     if ($(sigCanvas).width() / viewCanvas.width > $(sigCanvas).height() / viewCanvas.height) {
            //         scale = $(sigCanvas).width() / viewCanvas.width;
            //         viewCanvas.width = $(sigCanvas).width();
            //         viewCanvas.height = $(sigCanvas).height() * scale;
            //     } else {
            //         scale = $(sigCanvas).height() / viewCanvas.height;
            //         viewCanvas.width = $(sigCanvas).width() * scale;
            //         viewCanvas.height = $(sigCanvas).height();
            //     }

            // } else {
            //     if (viewCanvas.width / $(sigCanvas).width() > viewCanvas.height / $(sigCanvas).height()) {
            //         scale = viewCanvas.width / $(sigCanvas).width(); //縮小比率
            //         viewCanvas.height = $(sigCanvas).height() * scale;
            //     } else {
            //         scale = viewCanvas.height / $(sigCanvas).height(); //縮小比率
            //         viewCanvas.width = $(sigCanvas).width() * scale;
            //     }
            // }

            // var newCanvas = $("<canvas>").attr("width", imageData.width).attr("height", imageData.height)[0];
            // newCanvas.getContext("2d").putImageData(imageData, 0, 0);
            // viewContext.scale(scale, scale);
            // viewContext.drawImage(newCanvas, 0, 0);

            //回到前一畫面，並預覽繪圖
            $("#canvas_review").show();
            // $("body").css("overflow", "");

            // window.scrollTo(0, $('.studio_content_item_frame_content_illustrate.paint').offset().top); // 畫面移至繪圖題的位置
        }

        var sigCanvas;
        var context;
        var step_arr = []; //紀錄畫作軌跡
        var step_index;

        //塗鴉
        function paintHandler() {
            // get references to the canvas element as well as the 2D drawing context
            sigCanvas = document.getElementById("myCanvas");
            sigCanvas.width = $("#div_draw").width(); //重新設定畫布寬度
            sigCanvas.height = $("#div_draw").height(); //重新設定畫布高度
            
            context = sigCanvas.getContext("2d");
            context.fillStyle = "white"; //整個canvas塗上白色背景避免PNG的透明底色效果
            // context.fillRect(0, 0, $(sigCanvas).width(), $(sigCanvas).height());


            // This will be defined on a TOUCH device such as iPad or Android, etc.
            var is_touch_device = 'ontouchstart' in document.documentElement;
            if (is_touch_device) {
                sigCanvas.addEventListener('touchstart', function (e) {
                    //isDrawing = true;
                    this.ctx = this.getContext("2d");
                    this.touch = e.targetTouches[0];
                    this.ctx.strokeStyle = (isPen == 1) ? color : '#FFF';
                    this.ctx.lineWidth = size;

                    var o = this;
                    this.offsetX = this.offsetLeft;
                    this.offsetY = this.offsetTop;

                    while (o.offsetParent) {
                        o = o.offsetParent;
                        this.offsetX += o.offsetLeft;
                        this.offsetY += o.offsetTop;
                    }
                    //觸控點
                    var touchX = this.touch.pageX - this.offsetX;
                    var touchY = this.touch.pageY - this.offsetY;

                    this.ctx.beginPath();
                    this.ctx.moveTo(touchX, touchY);

                    e.preventDefault();
                }, false);

                sigCanvas.addEventListener('touchmove', function (e) {
                    this.touch = e.targetTouches[0];
                    //if (isDrawing) {
                    //觸控點
                    var touchX = this.touch.pageX - this.offsetX;
                    var touchY = this.touch.pageY - this.offsetY;

                    this.ctx.lineTo(touchX, touchY);

                    this.ctx.stroke();
                    //}
                    e.preventDefault();
                }, false);

                sigCanvas.addEventListener('touchend', function (e) {
                    //isDrawing = false;
                    e.preventDefault();

                    //紀錄畫作軌跡
                    recordStep();
                }, false);
            } else {
                //PC
                // start drawing when the mousedown event fires, and attach handlers to
                // draw a line to wherever the mouse moves to
                $("#myCanvas").mousedown(function (mouseEvent) {
                    var position = getPosition(mouseEvent, sigCanvas);
                    context.moveTo(position.X, position.Y);
                    context.beginPath();

                    // attach event handlers
                    $(this).mousemove(function (mouseEvent) {

                        //$(this).css("cursor", "url('Himages/C/imgs/2Ans_A2.png') 5 55,auto");//滑鼠樣式：鉛筆

                    }).mousemove(function (mouseEvent) {

                        drawLine(mouseEvent, sigCanvas, context);

                    }).mouseup(function (mouseEvent) {

                        finishDrawing(mouseEvent, sigCanvas, context);

                    }).mouseout(function (mouseEvent) {

                        $(this).css("cursor", "default");
                        finishDrawing(mouseEvent, sigCanvas, context);

                    });
                });
            }
        }

        // draws a line to the x and y coordinates of the mouse event inside
        // the specified element using the specified context
        function drawLine(mouseEvent, sigCanvas, context) {
            var position = getPosition(mouseEvent, sigCanvas);
            context.strokeStyle = (isPen == 1) ? color : '#FFF';
            context.lineWidth = size;
            context.lineTo(position.X, position.Y);
            context.stroke();
        }

        // draws a line from the last coordiantes in the path to the finishing
        // coordinates and unbind any event handlers which need to be preceded
        // by the mouse down event
        function finishDrawing(mouseEvent, sigCanvas, context) {
            // draw the line to the finishing coordinates            
            drawLine(mouseEvent, sigCanvas, context);
            context.closePath();

            // unbind any events which could draw
            $(sigCanvas).unbind("mousemove")
                .unbind("mouseup")
                .unbind("mouseout");

            //紀錄畫作軌跡
            recordStep();
        }

        // works out the X, Y position of the click inside the canvas from the X, Y position on the page
        function getPosition(mouseEvent, sigCanvas) {
            var x, y;

            if (mouseEvent.offsetX != undefined && mouseEvent.offsetY != undefined) {
                x = mouseEvent.offsetX;
                y = mouseEvent.offsetY;
            }
            return {
                X: x,
                Y: y
            };
        }

        //紀錄畫作軌跡
        function recordStep() {
            if (step_index != null) {
                //在有回到上一步下一步的情況時，畫了新的一筆軌跡後，要把其他某step_index後的軌跡刪除
                //redo按鈕不可按
                step_arr.splice(step_index + 1);
                $("#btn_redo").attr("disabled", "disabled");
            }

            //記錄新軌跡
            var imageData = context.getImageData(0, 0, sigCanvas.width, sigCanvas.height);
            step_arr.push(imageData);

            //記錄目前的step_index
            step_index = (step_index == null) ? 0 : step_index + 1;
            //console.log(step_index);

            //undo按鈕可按，讓使用個可回上一步
            if (step_index > 0) $("#btn_undo").attr("disabled", false);
        }

        //回上一步
        function undo() {
            step_index--;
            //回到最原始畫面時，undo按鈕不可按
            if (step_index == 0) $("#btn_undo").attr("disabled", true);
            //redo按鈕可按
            $("#btn_redo").attr("disabled", false);

            //重設畫步
            resetCanvas();
        }

        //下一步
        function redo() {
            step_index++;
            //盡頭了，則redo按鈕不可按
            if (step_index + 1 == step_arr.length) $("#btn_redo").attr("disabled", true);
            //undo按鈕可按
            $("#btn_undo").attr("disabled", false);

            //重設畫步
            resetCanvas();
        }

        //取得縮放比例
        var scaleW = 1;
        var scaleH = 1;

        //重設畫布
        function resetCanvas() {
            var imageData = step_arr[step_index];

            // var w0 = imageData.width; //視窗調整前的畫布寬度
            // var w1 = $("#div_draw").width(); //視窗調整後的畫布寬度
            // var h0 = imageData.height; //視窗調整前的畫布高度
            // var h1 = $("#div_draw").height(); //視窗調整後的畫布高度
            //取得縮放比例
            // scaleW = w1 / w0;
            // scaleH = h1 / h0;

            //隨著視窗尺寸調整，重新設定畫布的尺寸
            //PS.已經畫好的圖會消失
            sigCanvas.width = $("#div_draw").width(); //重新設定畫布寬度
            sigCanvas.height = $("#div_draw").height(); //重新設定畫布高度

            //將原圖的imageData塞到新的畫布中 在塞回調整尺寸後的原畫布裡
            //避免畫布因縮放比例 導致後來畫畫位置跑掉
            //根據新畫布寬度，與高度 裁取符合的imageData
            // var newCanvas = $("<canvas>").attr("width", imageData.width * scaleW).attr("height", imageData.height *
            //     scaleH)[0];
            // newCanvas.getContext("2d").putImageData(imageData, 0, 0);
            // context.drawImage(newCanvas, 0, 0);


        }

        //undo、redo
        //https://blog.csdn.net/robin_star_/article/details/83657188

        //清空畫布
        function clenCanvas() {
            var msg = "確定要清空畫面嗎？";
            ////語系轉換
            //switch (window.localStorage.getItem('Lang')) {
            //    case "en-US":
            //        //英文
            //        msg = "Are you sure you want to clear the screen?";
            //        break;
            //    case "zh-CN":
            //        //簡體
            //        msg = "确定要清空画面吗？";
            //        break;
            //}

            

            var toDo = confirm(msg);
            if (toDo) {
                //畫布回到初始畫面
                step_index = 0;
                //清除多餘軌跡
                step_arr = step_arr.slice(0, 1);

                //重設畫步
                resetCanvas();

                $("#btn_undo").attr("disabled", true);
                $("#btn_redo").attr("disabled", true);
            }
        }
    </script>

</body>

</html>