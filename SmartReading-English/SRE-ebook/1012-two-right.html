<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRE-eBook</title>

    <!-- this page widgets CSS -->
    <!-- modal -->
    <link rel="stylesheet" href="css/jquery.modal.min.css" />

    <link rel="shortcut icon" type="image/x-icon" href="image/favicon.ico" />
    <!-- <link rel="stylesheet" type="text/css" href="css/sre-ebook.css"> -->

    <link rel="stylesheet" type="text/css" href="css/SREebook.css">
</head>
<header>
    <div class="book-logo">
        <img src="image/logo.png" alt="">
    </div>
    <div class="book-title">A Small Seed with a Big Dream</div>
    <button class="close cursor background-icon"></button>
</header>

<div class="book-page two-right-book-page noMove">
    <div class="book-page-img">
        <div class="book-page-bg two-right-book-page-bg">
            <img src="image/picturebook/B1.png" alt="">
        </div>
        <div class="text two-right-text full-back">
            <div class="article">
                <p>
                    <span sindex="0" style="cursor: pointer;" class="listen_sentence">
                        <label style="font-size: 20px;">
                            Rabbit sees two monkeys playing in a tree.
                        </label>
                        <a href="#noMicrophone_modal" rel="modal:open" class="microphone_icon">
                            <i class="fa-solid fa-microphone-lines"></i>
                        </a>
                    </span>
                    <br>

                        <span sindex="0" style="cursor: pointer;" class="listen_sentence">
                            <label style="font-size: 20px;">
                                Rabbit sees two monkeys playing in a tree.
                            </label>
                            <a href="#noMicrophone_modal" rel="modal:open" class="microphone_icon">
                                <i class="fa-solid fa-microphone-lines"></i>
                            </a>
                        </span>
                    <br>

                    <span sindex="1" style="cursor: pointer;" class="listen_sentence">
                        <label style="font-size: 20px;">
                            One monkey says, "Give me five!"
                        </label>
                        <a href="#recording_modal" class="microphone_icon">
                            <i class="fa-solid fa-microphone-lines"></i>
                        </a>
                    </span>
                    <br>

                    <span sindex="2" style="cursor: pointer;" class="listen_sentence">
                        <label style="font-size: 20px;">
                            A
                        </label>
                        <a href="#recording_result_modal" class="microphone_icon">
                            <i class="fa-solid fa-microphone-lines"></i>
                        </a>
                    </span>
                    <br>

                    <span sindex="0" style="cursor: pointer;" class="">
                        <label style="font-size: 20px;">
                            Rabbit sees two monkeys playing in a tree.
                        </label>
                        <a href="#noMicrophone_modal" rel="modal:open" class="microphone_icon">
                            <i class="fa-solid fa-microphone-lines"></i>
                        </a>
                    </span>
                    <br>

                    <span sindex="1" style="cursor: pointer;" class="">
                        <label style="font-size: 20px;">
                            One monkey says, "Give me five!"
                        </label>
                        <a href="#recording_modal" class="microphone_icon">
                            <i class="fa-solid fa-microphone-lines"></i>
                        </a>
                    </span>
                    <br>
                </p>
            </div>
        </div>

    </div>
    <div class="word-area">
        <div class="book-circle">
            <ul>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
        </div>
        <div class="arrow cursor">
            <img src="image/button/arrow.svg" alt="">
        </div>
        <div class="word-title">
            詞彙
        </div>
        <div class="word">
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>
            <p>
                eye:
                <ruby>
                    <rb>眼睛</rb>
                    <rp>(</rp>
                    <rt>Yǎnjīng</rt>
                    <rp>)</rp>
                </ruby>
            </p>


        </div>
    </div>
</div>
<div class="play-area">
    <div class="progress">
        <div class="drag-line">
            <div class="line" style="width: 40%; height: 4px;"></div>
            <div class="draggable-button cursor"></div>
        </div>
        <div class="number-page">
            4/10
        </div>

    </div>
    <div class="play">
        <button class="cursor btn-prev background-icon"></button>
        <button class="cursor btn-play background-icon"></button>
        <button class="cursor btn-next background-icon"></button>
    </div>
</div>
<div class="button-area">
    <div class="sound">
        <button class="sound-img cursor background-icon"></button>
        <div id="bar_mc" class="sound-drag-line">
            <div class="sound-back-line">
            </div>
            <div class="sound-line" style="width:50%; height: 4px;">
            </div>
            <div id="move_mc" class="sound-draggable-button cursor"></div>
        </div>
    </div>

    <div class="button-menu">
        <ul>
            <!-- <li class="cursor" aria-label="加入書庫">
                <button class="btn-favorite cursor background-icon"></button>
            </li> -->
            <li id="li_listen" class="cursor" aria-label="聽讀 Listen">
                <button class="btn-listen cursor background-icon"></button>
                <div class="read-menu-container">
                    <p class="label-text">
                        <input type="checkbox" id="listen-id" checked="">
                        <span style="cursor: pointer;">聽讀<br>Listen</span>
                        <label for="listen-id" style="cursor: pointer;"></label>
                    </p>
                </div>
            </li>

            <li id="li_read" class="cursor" aria-label="唸讀 Read Aloud">
                <button class="btn-verbatim cursor background-icon"></button>
                <div class="read-menu-container">
                    <p class="label-text">
                        <input type="checkbox" id="read-id">
                        <span style="cursor: pointer;">唸讀<br>
                            Read Aloud</span>
                        <label for="read-id" style="cursor: pointer;"></label>
                    </p>
                </div>
            </li>

            <li class="cursor" aria-label="文字 Text">
                <button class="btn-font cursor background-icon"></button>
                <div class="font-menu-container">
                    <p class="label-text"><input type="checkbox" id="text-id" checked>
                        <span>文字 Text</span>
                        <label for="text-id"></label></p>
                    <!-- <p class="label-text"><input type="checkbox" id="pinyin-id" checked>
                        <span>拼音 Pinyin</span>
                        <label for="pinyin-id"></label></p> -->
                </div>
            </li>
            <!-- <li class="cursor" aria-label="詞彙">
                <button class="btn-word cursor background-icon simplified"></button>
                <div class="word-menu-container">
                    <p class="label-text"><input type="checkbox" id="word-id">
                        <span>詞彙</span>
                        <label for="word-id"></label></p>
                </div>
            </li> -->

            <li id="li_word" class="cursor" aria-label="單字 Word">
                <button class="btn-word cursor background-icon traditionale"></button>
                <div class="word-menu-container">
                    <p class="label-text"><input type="checkbox" id="word-id">
                        <span>單字 Word</span>
                        <label for="word-id"></label></p>
                </div>
            </li>
            <li class="cursor" aria-label="語速 Speed">
                <button class="btn-speak cursor background-icon"></button>
                <div class="speak-menu-container">
                    <p>0.5</p>
                    <p>1.0</p>
                    <p>1.5</p>
                </div>
            </li>
            <!-- <li class="cursor" aria-label="錄音">
                <button class="btn-record cursor background-icon"></button>
            </li> -->
            <li class="cursor" aria-label="放大" style="display: none;">
                <button class="btn-magnifier cursor background-icon"></button>
                <div class="magnifier-menu-container">
                    <p>0.5</p>
                    <p>1.0</p>
                    <p>1.5</p>
                </div>
            </li>
            <li class="cursor" aria-label="全螢幕 Full Screen">
                <button class="btn-screen cursor background-icon"></button>
            </li>

            <li class="cursor" aria-label="版權 copyright">
                <button class="btn-copyright cursor background-icon"></button>
            </li>
        </ul>
    </div>
</div>



<!-- 彈跳沒有麥克風開始 -->
<div id="noMicrophone_modal" class="modal noMicrophone_modal">
    <div class="noMicrophone_modal_content">
        <div class="noMicrophone_modal_title">
            <h4>
                Please insert your microphone!
            </h4>
            <h4>
                請插入麥克風！
            </h4>
        </div>
        <div class="noMicrophone_modal_icon">
            <i class="fa-solid fa-microphone-lines-slash"></i>
        </div>
        <div class="noMicrophone_modal_text">
            <p>
                無法錄音:无法录音：NotFoundError，无可用麦克风
            </p>
        </div>

        <div class="noMicrophone_modal_button_area">
            <div class="noMicrophone_modal_button">
                <a id="close-modal" href="#close-modal" rel="modal:close"
                    class="noMicrophone_modal_button_item noMicrophone_modal_close">
                    关闭 Close
                </a>
            </div>
        </div>
    </div>
</div>
<!-- 彈跳沒有麥克風結束 -->

<!-- 彈跳錄音開始 -->
<div id="recording_modal" class="modal recording_modal">
    <div class="recording_modal_content">
        <div class="recording_modal_title">
            <h4>
                請點選錄音並朗讀下面句子
            </h4>
        </div>

        <button class="recording_modal_icon_area listen_sentence_btn">
            <div class="recording_modal_icon">
                <i class="fa-solid fa-play"></i>
            </div>

            <p id="listenText">播放句子</p>
        </button>

        <div class="recording_modal_text">
            <h4>
                One monkey says, "Give me five!"
            </h4>
        </div>

        <div class="sound_bar_area">
            <!-- 播放時class加上"play_animation" -->
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <div class="record_play_area">
            <button class="recording_modal_icon_area record_play_area_item record_area_item">
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-microphone-lines"></i>
                </div>

                <p id="recordText">錄製聲音</p>
            </button>

            <button disabled="disabled" class="recording_modal_icon_area record_play_area_item play_area_item">
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-play"></i>
                </div>

                <p id="playText">播放錄音</p>
            </button>
        </div>

        <div class="recording_modal_medal_area">
            <div class="recording_modal_medal">
                <img src="image/photo/map/ebookman.png" alt="">
            </div>
        </div>

        <div class="recording_modal_button_area">
            <div class="recording_modal_button">
                <a id="close-modal" href="#close-modal" rel="modal:close"
                    class="recording_modal_button_item recording_modal_close">
                    关闭 Close
                </a>

                <a href="#recording_result_modal" class="recording_modal_button_item">
                    送出 send
                </a>
            </div>
        </div>
    </div>
</div>
<!-- 彈跳錄音結束 -->

<!-- 彈跳錄音結果開始 -->
<div id="recording_result_modal" class="modal recording_modal recording_result_modal">
    <div class="recording_modal_content">
        <div class="recording_modal_title">
            <h4>
                以下是你朗讀這個句子的表現
            </h4>
        </div>

        <div class="results_comments">
            <h4>
                評語
            </h4>
            
            <div class="results_comments_item results_comments_perfect">
                <h4>
                    Perfect
                </h4>
            </div>

            <div class="results_comments_item results_comments_good">
                <h4>
                    Good
                </h4>
            </div>

            <div class="results_comments_item results_comments_bad">
                <h4>
                    Fair
                </h4>
            </div>
        </div>

        <div class="results_presented_area">
            <div class="results_presented_area_title">
                <h4>
                    表現敘述
                </h4>
            </div>
            <div class="recording_modal_text">
                <h4>
                    <span class="perfect">One</span> <span class="good">monkey</span> <span class="bad">says Give me five</span>
                </h4>
            </div>
        </div>
        <br/>
        <div class="results_comments">
            <h4>發音：</h4>
            <div class="results_comments_item results_comments_perfect">
                <p>Perfect</p>
            </div>

             <div class="results_comments_item results_comments_good">
                <p>Good</p>
            </div>

            <div class="results_comments_item results_comments_bad">
                <p>Fair</p>
            </div>                
        </div>

        <div class="sound_bar_area">
            <!-- 播放時class加上"play_animation" -->
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>

        <div class="record_play_area">
            <button class="recording_modal_icon_area record_play_area_item your_voice_item">
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-play"></i>
                </div>

                <p id="recordText">你的聲音</p>
            </button>

            <button class="recording_modal_icon_area record_play_area_item teacher_voice_item">
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-play"></i>
                </div>

                <p id="playText">老師的聲音</p>
            </button>

            <a href="#recording_modal" rel="modal:open"
                class="recording_modal_icon_area record_play_area_item record_item">
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-arrow-rotate-right"></i>
                </div>
                <p id="playText">重錄</p>
            </a>

            <!-- <button onclick="#recording_result_modal" >
                <div class="recording_modal_icon">
                    <i class="fa-solid fa-arrow-rotate-right"></i>
                </div>

                <p id="playText">重錄</p>
            </button> -->
        </div>

        <div class="recording_modal_medal_area">
            <div class="recording_modal_medal">
                <img src="image/photo/map/ebookman.png" alt="">
            </div>
        </div>

        <div class="recording_modal_button_area">
            <div class="recording_modal_button">
                <a id="close-modal" href="#close-modal" rel="modal:close"
                    class="recording_modal_button_item recording_modal_close">
                    关闭 Close
                </a>
            </div>
        </div>
    </div>
</div>
<!-- 彈跳錄音結果結束 -->


<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/fontawesome-free-6.1.1.min.js"></script>

<!-- this page widgets JS -->
<!-- modal -->
<script src="js/jquery.modal.min.js"></script>

<!-- <script src="js/all.js"></script> -->

<script>

$('a[href="#recording_modal"]').click(function () {
        $(this).modal({
            clickClose: false
        });
    });
    
    $('a[href="#recording_result_modal"]').click(function () {
        $(this).modal({
            clickClose: false
        });
    });
</script>

<!-- <script>
    $('a[href="#recording_modal"]').click(function () {
        $(this).modal({
            clickClose: false
        });
    });

    $('a[href="#recording_result_modal"]').click(function () {
        $(this).modal({
            clickClose: false
        });
    });

    //點選播放聲音跟播放顯示聲音動態
    $(".listen_sentence_btn").click(function () {
        $(".sound_bar_area").toggleClass("play_animation");
        if ($(this).children('.recording_modal_icon').children('i').hasClass("fa-play")) { //原本是播放
            $(this).children('.recording_modal_icon').children('i').addClass("fa-stop");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-play");
            $(".record_area_item").attr("disabled", true);
            $(".play_area_item").attr("disabled", true);
            $(this).addClass("active");
        } else { //原本是停止
            $(this).children('.recording_modal_icon').children('i').addClass("fa-play");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-stop");
            $(".record_area_item").attr("disabled", false);
            $(".play_area_item").attr("disabled", false);
            $(this).removeClass("active");
        }

        var listenText = document.getElementById("listenText");
        if (listenText.innerHTML === "停止播放") {
            listenText.innerHTML = "播放句子";
        } else {
            listenText.innerHTML = "停止播放";
        }

    });

    //點選錄製聲音跟播放顯示聲音動態
    $(".record_area_item").click(function () {
        $(".sound_bar_area").toggleClass("play_animation");
        if ($(this).children('.recording_modal_icon').children('i').hasClass("fa-microphone-lines")) { //原本是播放
            $(this).children('.recording_modal_icon').children('i').addClass("fa-stop");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-microphone-lines");
            $(".listen_sentence_btn").attr("disabled", true);
            $(".play_area_item").attr("disabled", true);
            $(this).addClass("active");
        } else { //原本是停止
            $(this).children('.recording_modal_icon').children('i').addClass("fa-microphone-lines");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-stop");
            $(".listen_sentence_btn").attr("disabled", false);
            $(".play_area_item").attr("disabled", false);
            $(this).removeClass("active");
        }

        var recordText = document.getElementById("recordText");
        if (recordText.innerHTML === "停止錄製") {
            recordText.innerHTML = "錄製聲音";
        } else {
            recordText.innerHTML = "停止錄製";
        }

    });

    //點選播放跟播放顯示聲音動態
    $(".play_area_item").click(function () {
        $(".sound_bar_area").toggleClass("play_animation");
        if ($(this).children('.recording_modal_icon').children('i').hasClass("fa-play")) { //原本是播放
            $(this).children('.recording_modal_icon').children('i').addClass("fa-stop");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-play");
            $(".record_area_item").attr("disabled", true);
            $(".listen_sentence_btn").attr("disabled", true);
            $(this).addClass("active");
        } else { //原本是停止
            $(this).children('.recording_modal_icon').children('i').addClass("fa-play");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-stop");
            $(".record_area_item").attr("disabled", false);
            $(".listen_sentence_btn").attr("disabled", false);
            $(this).removeClass("active");
        }

        var playText = document.getElementById("playText");
        if (playText.innerHTML === "停止") {
            playText.innerHTML = "播放";
        } else {
            playText.innerHTML = "停止";
        }

    });

    //點選你的聲音
    $(".your_voice_item").click(function () {
        $(".sound_bar_area").toggleClass("play_animation");
        if ($(this).children('.recording_modal_icon').children('i').hasClass("fa-play")) { //原本是播放
            $(this).children('.recording_modal_icon').children('i').addClass("fa-stop");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-play");
            $(".teacher_voice_item").attr("disabled", true);
            $(".record_item").attr("disabled", true);
            $(this).addClass("active");
        } else { //原本是停止
            $(this).children('.recording_modal_icon').children('i').addClass("fa-play");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-stop");
            $(".teacher_voice_item").attr("disabled", false);
            $(".record_item").attr("disabled", false);
            $(this).removeClass("active");
        }
    });

    //點選老師的聲音
    $(".teacher_voice_item").click(function () {
        $(".sound_bar_area").toggleClass("play_animation");
        if ($(this).children('.recording_modal_icon').children('i').hasClass("fa-play")) { //原本是播放
            $(this).children('.recording_modal_icon').children('i').addClass("fa-stop");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-play");
            $(".your_voice_item").attr("disabled", true);
            $(".record_item").attr("disabled", true);
            $(this).addClass("active");
        } else { //原本是停止
            $(this).children('.recording_modal_icon').children('i').addClass("fa-play");
            $(this).children('.recording_modal_icon').children('i').removeClass("fa-stop");
            $(".your_voice_item").attr("disabled", false);
            $(".record_item").attr("disabled", false);
            $(this).removeClass("active");
        }
    });

    //點選重錄
    $(".record_item").click(function () {
        $(".sound_bar_area").removeClass("play_animation");
    });
</script> -->



<script>
    var pageIndex = 0;
    var pagesCount = 0;
    var data = "";
    var fontSize = "22px";

    var audio;
    var soundMode = true;//預設非聲音模式

    function LoadBook() {
        $.ajax({
            type: "GET",
            url: path + "detail.json?time=" + new Date().getTime(),
            data: "",
            dataType: "json",
            success: function (response) {
                data = response;
                //getOut(data["myID"]);

                //初始書本基本資料
                $(".book-title").html(data["name"]);
                pagesCount = data["pagesCount"];
                if (data["copyright"] == undefined) $(".btn-copyright").css("display", "none");

                //無音檔時，沒有聲音相關的元件
                if (!data["hasSound"]) {
                    $(".sound").css("visibility", "hidden");
                    $("#li_listen").hide();
                    $("#li_read").hide();
                    $("#li_speed").hide();
                    $("#li_read").hide();
                }

                //無單字時，單字元件不可點選
                if (!data["hasWord"]) $(".btn-word").prop("disabled", true);
                
                
                //內容
                ShowPage();

                //頁碼
                pagesLine();
            },
            error: function (jqXHR, textStatus, err) {
                document.write(jqXHR.responseText);
                //console.log("[LoadBook]：" + jqXHR.responseText);
            }
        }).then(function () {                
            
            });
    }

    //設定無插圖時，文字框大小
    var nopic_w = 0;
    var nopic_h = 0;
    var page;
    var now_type = "cover"; //所在頁的版型

    //練習唸讀的句子
    var speak_text0 = "";
    var speak_text = "";

    //顯示本文
    function ShowPage() {
        $("#book-page").removeClass().addClass("book-page").addClass("noMove");
        $("#book-page-img").removeClass().addClass("book-page-img").empty();
        $(".word").empty();

        page = data["pages"][pageIndex];
        now_type = page["type"];

        var text = (page["type"] != "cover" && page["type"] != "end" && page["type"] != "none" && page["type"] != "copyright") ? TextMergePinyin(page) : "";
                
        switch (page["type"]) {
            case "cover":
            case "none":
            case "end":
                $("#book-page-img").append('<div class="book-page-bg"><img src="' + path + 'images/' + page["image"] + '" alt="" /></div>');
                break;

            case "top-center":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence top-center-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "top-left":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence top-left-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "top-right":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence top-right-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "top-half":
                $("#book-page-img").addClass("half-book-page-img");
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text half-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "bottom-center":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence bottom-center-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "bottom-left":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence bottom-left-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "bottom-right":
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text sentence bottom-right-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "bottom-half":
                $("#book-page-img").addClass("half-book-page-img picture-below");
                $("#book-page-img").append('<div class="book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text half-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "two-right":
                $("#book-page").addClass("two-right-book-page");
                $("#book-page-img").append('<div class="book-page-bg two-right-book-page-bg"></div>');
                if (text != "") $("#book-page-img").append('<div class="text two-right-text full-back"><div class="article"><p>' + text + '</p></div></div>');
                var img = new Image();
                img.onload = function () {
                    Resize();
                }
                img.src = path + 'images/' + page["image"];
                $(".book-page-bg").append(img);
                break;

            case "nopic":
                $("#book-page-img").append('<div class="book-page-bg top-book-page-bg"></div>');
                $("#book-page-img").append('<div class="text top-text"><div class="article"><p>' + text + '</p></div></div>');
                var img = new Image();
                img.onload = function () {
                    Resize();
                }
                img.src = 'image/bg/nopic-bg.png';
                $(".book-page-bg").append(img);
                break;

            case "top":
                $("#book-page-img").addClass("template-book-page-img");
                $("#book-page-img").append('<div class="book-page-bg"></div>');

                if (text != "") $("#book-page-img").append('<div class="text top-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "copyright":
                var addText = (page["text"] == undefined) ? "" : page["text"]; //版權頁增加內容
                text = getCopyright(data["name"],addText);
                //console.log(text);
                $("#book-page-img").append('<div class="book-page-bg top-book-page-bg"></div>');
                $("#book-page-img").append('<div class="text top-text"><div class="article"><p>' + text + '</p></div></div>');

                addImage(data["pages"][0]["image"]);
                break;

            //2022.09.28新增兩個版型
            case "big-top-half":
                $("#book-page-img").addClass("half-book-page-img big-half-book-img");
                $("#book-page-img").append('<div class="book-page-bg"></div>');                            
                if (text != "") $("#book-page-img").append('<div class="text half-text big-half-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;

            case "big-bottom-half":
                $("#book-page-img").addClass("half-book-page-img picture-below big-half-book-img");
                $("#book-page-img").append('<div class="book-page-bg"></div>');                            
                if (text != "") $("#book-page-img").append('<div class="text half-text big-half-text"><div class="article"><p>' + text + '</p></div></div>');
                addImage(page["image"]);
                break;
        }

        //沒有文字內容，關閉唸讀功能、文字功能
        if (page["type"] == "cover" || page["type"] == "end" || page["type"] == "none" || page["type"] == "copyright") {
            //唸讀功能 不可點選
            $('.btn-verbatim').prop('disabled', true); 
            //文字功能
            $('.btn-font').prop('disabled', true);
        } else {
            //唸讀功能 可點選
            $('.btn-verbatim').prop('disabled', false); 
            //文字功能 可點選
            $('.btn-font').prop('disabled', false);
        }

        //單字
        if (data["hasWord"] || (page["type"] != "end" && page["type"] != "none" && page["type"] != "copyright")) {
            if (page["type"] != "end" && page["type"] != "none" && page["type"] != "copyright") {
                if (page["wordlist"] != undefined && page["wordlist"] != "") {
                    page["wordlist"].forEach(function (word) {
                        if (data["hasSound"]) {
                            //有音檔                                    
                            $(".word").append('<p><label id="' + word["sound"] + '">' + word["word"] + ' ' + word["zh"] + '</label></p>');
                        } else {
                            //無音檔
                            $(".word").append('<p>' + word["word"] + ' ' + word["zh"] + '</p>');
                        }
                    });
                    //單字功能鍵可點選
                    $('.btn-word').prop('disabled', false);
                    $("#word-id").prop("checked", false);

                    if($(".word-area").hasClass("open")) $("#word-id").prop("checked", true);

                } else {
                    //單字功能鍵不可點選
                    $('.btn-word').prop('disabled', true);
                    $("#word-id").prop("checked", false);

                    $(".word-area").removeClass("open");
                    $(".book-page").removeClass("move");
                    $(".book-page").addClass("noMove");
                }
            } else {
                //單字功能鍵不可點選
                $('.btn-word').prop('disabled', true);
                $("#word-id").prop("checked", false);

                $(".word-area").removeClass("open");
                $(".book-page").removeClass("move");
                $(".book-page").addClass("noMove");
            }
        }                    
        if($(".word-menu-container").hasClass("open")) $(".word-menu-container").removeClass("open");
        if($(".speak-menu-container").hasClass("open")) $(".speak-menu-container").removeClass("open");
        if($(".font-menu-container").hasClass("open")) $(".font-menu-container").removeClass("open");
        if($(".read-menu-container").hasClass("open")) $(".read-menu-container").removeClass("open");
                
        if ($(".word-area").hasClass("open")) $(".book-page").addClass("move");

        //調整字體大小
        if (page["type"] != "copyright") {
            if (data["fontSize"] != undefined && data["fontSize"] != "") fontSize = data["fontSize"];
            if (page["fontSize"] != undefined && page["fontSize"] != "") fontSize = page["fontSize"];
            $(".text p").css("font-size", fontSize);
            $(".text p label").css("font-size", fontSize);
        }

        //音檔
        if (page["type"] != "end" && page["type"] != "none" && page["type"] != "copyright" && data["hasSound"]) {
            if ($("#listen-id").is(":checked")) {
                $(".play .btn-play").attr("disabled", false);
                $(".play .btn-play").removeClass("disabled");
            }

            mp3_arr = page["sound"].split("|");

            if (soundMode) {
                $("label").css("cursor", "pointer");
            } else {
                $("label").css("cursor", "");
            }

            //是否為唸讀模式
            if ($("#read-id").is(":checked")) {
                $(".listen_sentence").addClass("microphone_show");                    
            } else {
                $(".listen_sentence").removeClass("microphone_show");
            }

            //正文，逐句點選播放
            $(".text label").click(function () {

                //點選處理
                wordsClick($(this));
                //播放聲音
                playSentence($(this).attr("sIndex"));
            });

            //開啟唸讀Modal
            $(".text a").click(function () {
                if(dictate == undefined) setDictate();
                //console.log("dictate", dictate);
                
                //console.log("dictate1", dictate);
                //找出所點選的字句
                var label = $(this).parent().find("label");

                //紀錄練習唸讀的句子
                speak_text0 = label.text(); //保留原始句樣貌
                speak_text = label.text();
                if (speak_text.indexOf(":") > -1) speak_text = speak_text.split(":")[1];
                speak_text = speak_text.replace(/\./g, "").replace(/,/g, "").replace(/!/g, "").replace(/\?/g, "").replace(/“/g, "").replace(/”/g, "").replace(/"/g, "");
                //console.log("speak_text",speak_text);

                //顯示句子內容
                $("#recordingText").html("<h4>" + label.text() + "</h4>");

                ReadModal(label.attr("sIndex"));
            });

            if (page["wordlist"] != undefined) {
                //單字點播
                $(".word label").click(function () {
                    //點選處理
                    wordsClick($(this));
                    //播放聲音
                    playWord($(this).attr("id"));
                });
            }
        } else {
            if (page["type"] == "none" && page["sound"] != undefined) {
                //僅有圖，但有聲音的狀況
                if ($("#listen-id").is(":checked")) {
                    $(".play .btn-play").attr("disabled", false);
                    $(".play .btn-play").removeClass("disabled");
                } else {
                    $(".play .btn-play").attr("disabled", true);
                    $(".play .btn-play").addClass("disabled");
                }

                mp3_arr = page["sound"].split("|");
            } else {
                        
                $(".play .btn-play").attr("disabled", true);
                $(".play .btn-play").addClass("disabled");
            }
        }

        ShowPinyin();
        ShowText();
        pageBtnReset();
    }

    //顯示版權頁
    function ShowCopyright() {
        now_type = "copyright";

        $(".word").empty();
        $("#book-page").removeClass().addClass("book-page copyright-page noMove");
        $("#book-page-img").removeClass().addClass("book-page-img").empty();

        //襯底圖
        $("#book-page-img").append('<div class="book-page-bg"></div>');
        var img = new Image();
        img.onload = function () {
            Resize();
        }
        img.src = (data["copyright"][0]["type"] == "copyright")? path + 'images/' + data["pages"][0]["image"] : 'image/bg/nopic-bg.png';
        $(".book-page-bg").append(img);
        //襯底圖

        var tmp = "";
        var copyCount = data["copyright"].length;
        for (var i = 0; i < copyCount; i++) {
            page = data["copyright"][i];

            var text = (page["type"] != "none" && page["type"] != "copyright") ? TextMergePinyin(page) : "";

            switch (page["type"]) {
                case "none":
                    tmp += '<img src="' + path + 'images/' + page["image"] + '" alt="" />';
                    break;

                case "nopic":
                    tmp += '<p>' + text + '</p>';
                    break;

                case "copyright":
                    var addText = (page["text"] == undefined) ? "" : page["text"]; //版權頁增加內容
                    text = getCopyright(data["name"], addText);
                    tmp += '<p>' + text + '</p>';
                    break;
            }
        }
        $("#book-page-img").append('<div class="text top-text"><div class="article">' + tmp + '</div><button class="copyright-close cursor background-icon"></button></div>');

        $(".word-area").removeClass("open");

        //音檔
        $(".play .btn-play").attr("disabled", true);
        $(".play .btn-play").addClass("disabled");

        //關閉版權頁
        $('.copyright-close').click(function () {
            ShowPage();
        });
    }

    //每一頁加入圖檔，並調整文字框大小
    function addImage(image) {
        var img = new Image();
        img.onload = function () {
            Resize();
        }
        img.src = path + 'images/' + image;
        $(".book-page-bg").append(img);
    }

    $(window).on('resize', function () {
        Resize();
    });

    function Resize() {
        switch (now_type) {
            // 版型:句子開始
            case "top-center":
            case "top-left":
            case "top-right":
            case "bottom-center":
            case "bottom-left":
            case "bottom-right":
                var sentenceWidth = $(".book-page-bg > img").width();
                var sentenceHeight = $(".book-page-bg > img").height();
                $(".sentence").css({
                    "width": sentenceWidth,
                    "height": sentenceHeight
                });
                break;
            // 版型:句子結束

            // 版型:上下圖文開始
            case "top-half":
            case "bottom-half":
            case "big-top-half":
            case "big-bottom-half":
                var halfTextWidth = $(".book-page-bg > img").width();
                $(".half-text").css({
                    "max-width": halfTextWidth
                });
                break;
            // 版型:上下圖文結束

            
            // 版型:文壓圖開始
            case "nopic":
            case "top":
            case "copyright":
                var topTextWidth = $(".book-page-bg > img").width();
                var topTextHeight = $(".book-page-bg > img").height();
                $(".top-text").css({
                    "width": topTextWidth,
                    "height": topTextHeight
                });
                break;
            // 版型:文壓圖結束

            // 版型:兩頁開始
            case "two-right":
                if ($(window).width() <= 1024) {
                    var twoRightTextWidth = $(".book-page-bg > img").width();
                    $(".two-right-text").css({
                        "width": twoRightTextWidth
                    });
                    var twoRightTextHeight = $(".book-page-bg > img").height() / 2;
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                } else {
                    var twoRightTextWidth = $(".book-page-bg > img").width();
                    $(".two-right-text").css({
                        "width": twoRightTextWidth
                    });
                    var twoRightTextHeight = $(".book-page-bg > img").height();
                    //console.log($(window).width(), twoRightTextHeight);
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                }
                break;
            // 版型:兩頁結束
        }

        SetAlign();
    }

    function SetAlign() {
        //文字對其方式
        if ($('.article').height() > $('.text').height()) {
            //靠上
            $('.text').css({
                "display": "flex",
                "align-items": "flex-start"
            });
        } else {
            //上下置中
            $('.text').css({
                "display": "flex",
                "align-items": "center"
            });
        }
    }

    function TextMergePinyin(page) {
        var text = "";

        //段落
        var text_part_arr = page["text"].split('<br/>');
        var index = 0;//標記句子索引，以便和音檔相對應

        text_part_arr.forEach(function (part, i) {

            if (part != "") {

                //句子
                var text_span_arr = part.split("|");
                
                text_span_arr.forEach(function (span, j) {
                    if (span != "") {
                        if (data["hasSound"]) {
                            text += "<span class='listen_sentence'><label sIndex='" + index + "'>" + span + "</label>";
                            text += "<a href='#recording_modal' rel='modal:open' class='microphone_icon'><i class='fa-solid fa-microphone-lines'></i></a></span>";
                        } else {
                            text += "<span><label sIndex='" + index + "'>" + span + "</label></span>";
                        }

                        
                        index++;
                    }
                });
            }
            text += "<br />";
            
        });

        //console.log("text", text);
        return text;
    }

    function isSymbol(_unit) {
         
        var symbol = "<>-，。？?！!：:、-「」“”〈〉《》—…….–";
        if (symbol.indexOf(_unit) == -1) {
            return false;
        } else {
            return true;
        }
    }
</script>

<!--audio-->
<script>
    var mp3_arr = [];
    var audio = document.createElement('audio');
    var source = document.createElement('source');

    var audio_type = 0; //播放模式。0：auto、1：pause、2：continue
    var audio_rate = 1; //語速
    var audio_volume = 0.5; //音量。0~1
    var audio_index = 0;    //目前播放的索引mp3
    var isEnd = true;       //當頁全文自動播放是否結束的狀態，預設為結束狀態，音軌回到最前面。

    $(document).ready(function () {
        //語速調整
        $("#li_speed p").click(function () {
            $("#li_speed p").css("font-weight", "");
            $(this).css("font-weight", "bold");

            audio_rate = $(this).text();
            audio.playbackRate = audio_rate;

            speaking.classList.toggle("open");//關閉選單
        });

        //初始設定音量
        $("#move_mc").css("left", "50px");
    });

    //pause 或 play
    //全文自動播放
    $(".btn-play").click(function () {
        $(this).toggleClass("pause");

        $("label").css("color", "");
        
        if (isEnd) {
            //在這之前是句字詞彙點選播放的情況
            
            isEnd = false;
            if (pageIndex == 0) {

            } else {
                $("span:eq(" + audio_index + ")").find("label").css("color", "red");
            }
            play(audio_index);
            
        } else {
            if (pageIndex == 0) {
                //首頁播放
                play(0);

            } else {
                if ($(this).hasClass("pause")) {
                    $("span:eq(" + audio_index + ")").find("label").css("color", "red");
                    audio.play();
                } else {
                    audio.pause();
                }
            }
        }
    });

    function play(index) {
            
        //Listen模式下，且不是詞彙句字的點播模式
        if (soundMode && !isEnd) {
            audio_index = index;
            audio.src = path + 'audio/' + mp3_arr[index];
            //console.log(mp3_arr[index]);
            audio.volume = audio_volume;    //音量 
            audio.playbackRate = audio_rate;//語速
            audio.play();                

            if (!$(".btn-play").hasClass("pause")) $(".btn-play").addClass("pause");
            $("span:eq(" + index + ")").find("label").css("color", "red");
        
            audio.onended = function () {
                $("label").css("color", "");
                
                if (index < mp3_arr.length - 1) {
                    index++;

                    play(index);
                } else {
                    $(".btn-play").removeClass("pause");
                    audio_index = 0; //回到第一句話
                    isEnd = true;
                }
            }
        }
    }

    //點選處理。句子或單字變色，播放鍵樣式處裡
    function wordsClick(target) {
        isEnd = true;
        audio_index = 0; //全文自動播放的音軌，回到第一句話

        if (soundMode) {
            $("label").css("color", "");
            //$(target).find("label").css("color", "red");
            $(target).css("color", "red");

            $(".btn-play").removeClass("pause");
        }
    }

    //句子播放
    function playSentence(index) {
        //Listen模式下
        if (soundMode) {
            audio.src = path + 'audio/' + mp3_arr[index];
            //console.log(mp3_arr[index]);
            audio.volume = audio_volume;    //音量 
            audio.playbackRate = audio_rate;//語速
            audio.play();

            audio.onended = function () {
                $("label").css("color", "");
            }
        }
    }

    //詞彙播放
    function playWord(file) {
        //Listen模式下
        if (soundMode) {
            //播放鍵改成播放樣式
            if ($(".btn-verbatim").hasClass("end-verbatim")) $(".btn-verbatim").removeClass("end-verbatim");
            //audio_index = 0;

            audio.src = path + 'audio/' + file;
            audio.volume = audio_volume;    //音量 
            audio.playbackRate = audio_rate;//語速
            audio.play();

            audio.onended = function () {
                $("label").css("color", "");
            }
        }
    }

    //設定靜音
    $(".sound-img").click(function () {
        if (audio.volume == 0) {
            audio_volume = 0.5;
            $(".sound-line").css("width", "50%");
            $("#move_mc").css("left", "50px");
        } else {
            audio_volume = 0;
            $(".sound-line").css("width", "0%");
            $("#move_mc").css("left", "0px");
        }
        SetVolume();
    });
    

    //設定音量
    function SetVolume() {
        if (audio_volume == 0) {
            $(".sound-img").addClass("mute");
        } else {
            $(".sound-img").removeClass("mute");
        }
        audio.volume = audio_volume;
    }

</script>

<!--頁碼-->
<script>
    //鍵盤方向鍵控制上下頁
    $(document).ready(function () {
        $("body").keydown(function (event) {
            if (event.keyCode == 37) toPre();
            if (event.keyCode == 39) toNext();
        });
    });

    $(".btn-prev").click(toPre);
    $(".btn-next").click(toNext);

    function toPre() {
        //翻頁後
        isEnd = true;
        audio.pause();
        audio_index = 0;
        if ($(".btn-play").hasClass("pause")) $(".btn-play").removeClass("pause");

        if (pageIndex > 0) {
            pageIndex--;
            pagesLine();  
            
            ShowPage();
        }
    }

    function toNext() {
        //下一頁
        isEnd = true;
        audio.pause();
        audio_index = 0;
        if ($(".btn-play").hasClass("pause")) $(".btn-play").removeClass("pause");

        toNextPage();
    }

    var testURL = ""; //讀後測驗網址
    //本文下一頁
    function toNextPage() {
        if (pageIndex < pagesCount - 1) {
            pageIndex++;
            pagesLine();

            ShowPage();
        } else {
            startSpin();

            $.ajax({
                type: "POST",
                url: "ebook_cn.aspx/ReadEnd",
                data: JSON.stringify({
                    path: path
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var data = jQuery.parseJSON(decodeURIComponent(response.d));
                    getOut(data["myID"]);

                    //閱讀章顯示效果
                    if (data["toShow"] == "1") {
                        //$("#div_1").modal("open");
                        
                        //開啟小視窗，點選空白處不可關閉
                        $("#div_1").modal({
                            escapeClose: false,
                            clickClose: false,
                            showClose: false
                        });

                        var level = path.split("/")[0] + ".png"
                        $("#img_read1").attr("src", "image/photo/medal/" + level);

                        //是否可測驗
                        if (data["canTest"] == "1") {
                            $("#div_btnTest").css("display", "block");
                            $("#div_btnClose").css("display", "none");
                        } else {
                            $("#div_btnTest").css("display", "none");
                            $("#div_btnClose").css("display", "block");
                        }
                    } else {
                        
                        //是否可測驗
                        if (data["canTest"] == "1") {
                            //$("#div_2").modal("open");
                            $("#div_2").modal({
                                escapeClose: false,
                                clickClose: false,
                                showClose: false
                            });
                        } else {
                            //$("#div_3").modal("open");
                            $("#div_3").modal({
                                escapeClose: false,
                                clickClose: false,
                                showClose: false
                            });
                        }
                    }
                    
                    testURL = data["url"] + "&lang=" + lang;

                    $(".line").css("width", "100%");
                    $(".number-page").html((pagesCount + 1) + "/" + (pagesCount + 1));
                },
                error: function (jqXHR, textStatus, err) {
                    console.log("[toNextPage]: " + jqXHR.responseText);
                }
            }).then(function () {
                stopSpin();//關閉lodaing畫面
            });
        }
    }

    //頁碼百分比
    function pagesLine() {
        var currentPage = pageIndex + 1;
        var percentage = (pageIndex + 1) / parseInt(pagesCount) * 100 - 5;
        $(".line").css("width", percentage + "%");
        $(".number-page").html(currentPage + "/" + (pagesCount + 1));
    }

    function pageBtnReset() {
        $(".play .btn-prev").attr("disabled", false);
        $(".play .btn-next").attr("disabled", false);

        //上一頁
        if (pageIndex == 0) {
            $(".play .btn-prev").attr("disabled", true);
            $(".play .btn-prev").addClass("disabled");
        } else {
            $(".play .btn-prev").removeClass("disabled");
        }

        //下一頁
        if (pageIndex == pagesCount) {
            $(".play .btn-next").attr("disabled", true);
            $(".play .btn-next").addClass("disabled");
        } else {
            $(".play .btn-next").removeClass("disabled");
        }
    }

</script>

<!--功能切換-->
<script>
    var textShow = true;
    var pinyinShow = true;

    $(document).ready(function () {
        //關閉
        $('.close').click(function () {
            window.opener = null;
            window.close();
        });

        //功能點選，打開或關閉選單
        $(".button-menu ul li button").click(function() {
            $(this).siblings().toggleClass("open");
            $(this).parent().siblings().children().siblings().removeClass("open");
        });

        //全螢幕
        $('.btn-screen').click(function () {
            if (document.fullscreen) {
                //關
                $("#btn-screen").removeClass("end-screen").addClass("btn-screen");
            } else {
                //開
                $("#btn-screen").removeClass("btn-screen").addClass("end-screen");
            }
            
            screenfull.toggle();
        });

        //拼音、文字切換
        $("#pinyin-id").change(function () {
            if ($(this).is(":checked")) {
                
                pinyinShow = true;
            } else {
                
                pinyinShow = false;
            }

            ShowPinyin();
        });

        $("#text-id").change(function () {
            if ($(this).is(":checked")) {
                //$(".text p").show();
                textShow = true;
            } else {
                //$(".text p").hide();
                textShow = false;
            }

            ShowText();
        });

        //聽切換
        $("#listen-id").change(function () {
            if ($(this).is(":checked")) {
                soundMode = true;                    
                
                //PLAY鍵
                // if ((page["type"] != "end" && page["type"] != "none" && page["type"] != "copyright") || (page["type"] == "none" && page["sound"] != undefined)) {
                //     //$(".btn-play").css("visibility", "visible");
                //     $(".play .btn-play").attr("disabled", false);
                //     $(".play .btn-play").removeClass("disabled");
                // }
                if ($(this).is(":checked")) {
                    //$(".btn-play").css("visibility", "visible");
                    $(".play .btn-play").attr("disabled", false);
                    $(".play .btn-play").removeClass("disabled");
                }

                //喇叭與音量
                $(".sound-draggable-button").removeClass("grey");
                $(".sound-line").removeClass("grey");
                $('.sound-img').prop('disabled', false);
                $('.btn-speak').prop('disabled', false);
                //句子
                $("span").css("cursor", "pointer");
            } else {
                soundMode = false;
                                    
                //PLAY鍵
                //$(".btn-play").css("visibility","hidden");//$(".btn-play").hide();
                $(".play .btn-play").attr("disabled", true);
                $(".play .btn-play").addClass("disabled");

                //喇叭與音量
                $(".sound-draggable-button").addClass("grey");
                $(".sound-line").addClass("grey");
                $('.sound-img').prop('disabled', true);
                $('.btn-speak').prop('disabled', true);
                //句子
                $("span").css("cursor", "");

                //關閉正在播放的聲音
                isEnd = true;
                audio.pause();
                audio_index = 0;
                if ($(".btn-play").hasClass("pause")) $(".btn-play").removeClass("pause");
                $("label").css("color", "");

            }
        });

        //唸讀切換
        $("#read-id").change(function () {
            if ($(this).is(":checked")) {
                $(".listen_sentence").addClass("microphone_show");
                //alert("此功能需插入麥克風");
            } else {
                $(".listen_sentence").removeClass("microphone_show");
            }
        });

        //單字表
        $("#word-id").change(function () {
            if ($(this).is(":checked")) {
                $(".word-area").addClass("open");
                $(".book-page").addClass("move");
                $(".book-page").removeClass("noMove");

                // 版型:兩頁開始
                var twoRightHeight = $(".book-page-bg > img").height();
                $(".two-right-text").css({
                    "max-height": twoRightHeight
                });
                // 版型:兩頁結束

                // 版型:文壓圖開始
                var topTextHeight = $(".book-page-bg > img").height();
                $(".top-text").css({
                    "max-height": topTextHeight
                });
                // 版型:文壓圖結束

                // 版型:句子開始
                var sentenceHeight = $(".book-page-bg > img").height();
                $(".sentence").css({
                    "max-height": sentenceHeight
                });
                // 版型:句子結束

                if ($(window).width() <= 1024) {

                    // 版型:兩頁開始
                    var twoRightTextHeight = $(".book-page-bg > img").height() / 2;
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                    // 版型:兩頁結束
                }

            } else {
                $(".word-area").removeClass("open");
                $(".book-page").removeClass("move");
                $(".book-page").addClass("noMove");

                // 版型:兩頁開始
                $(".two-right-text").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:兩頁結束

                // 版型:文壓圖開始
                $(".top-text").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:文壓圖結束

                // 版型:句子開始
                $(".sentence").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:句子結束

                if ($(window).width() <= 1024) {

                    // 版型:兩頁開始
                    var twoRightTextHeight = $(".book-page-bg > img").height() / 2;
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                    // 版型:兩頁結束
                }
            }
        });

        
        //單字表
        $("#word-id").click(function () {
            if ($(this).is(":checked")) {
                $(".word-area").addClass("open");
                $(".book-page").addClass("move");
                $(".book-page").removeClass("noMove");

                // 版型:兩頁開始
                var twoRightHeight = $(".book-page-bg > img").height();
                $(".two-right-text").css({
                    "max-height": twoRightHeight
                });
                // 版型:兩頁結束

                // 版型:文壓圖開始
                var topTextHeight = $(".book-page-bg > img").height();
                $(".top-text").css({
                    "max-height": topTextHeight
                });
                // 版型:文壓圖結束

                // 版型:句子開始
                var sentenceHeight = $(".book-page-bg > img").height();
                $(".sentence").css({
                    "max-height": sentenceHeight
                });
                // 版型:句子結束

                if ($(window).width() <= 1024) {

                    // 版型:兩頁開始
                    var twoRightTextHeight = $(".book-page-bg > img").height() / 2;
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                    // 版型:兩頁結束
                }

            } else {
                $(".word-area").removeClass("open");
                $(".book-page").removeClass("move");
                $(".book-page").addClass("noMove");

                // 版型:兩頁開始
                $(".two-right-text").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:兩頁結束

                // 版型:文壓圖開始
                $(".top-text").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:文壓圖結束

                // 版型:句子開始
                $(".sentence").css({
                    "max-height": "calc(100vh - 240px)"
                });
                // 版型:句子結束

                if ($(window).width() <= 1024) {

                    // 版型:兩頁開始
                    var twoRightTextHeight = $(".book-page-bg > img").height() / 2;
                    $(".two-right-text").css({
                        "max-height": twoRightTextHeight
                    });
                    // 版型:兩頁結束
                }
            }
        });

        
        
        //版權
        $('.btn-copyright').click(function () {
            ShowCopyright();
        });

        //modal
        //關閉：提示前往測驗的小視窗，回到真正的最後一頁，調整進度條
        $("#close-modal1").click(function () {
            pagesLine();
        });
        $("#close-modal2").click(function () {
            pagesLine();
        });
        $("#close-modal3").click(function () {
            pagesLine();
        });
    });

    //拼音顯示
    function ShowPinyin() {
        if (pinyinShow) {
            //$('.text rt').css("visibility", "visible");
            $(".text p > span > label > rt").show();
        } else {
            //$('.text rt').css("visibility", "hidden");
            $(".text p > span > label > rt").hide();
        }
    }

    //內文顯示
    function ShowText() {
        if (textShow) {
            $(".text p").show();
        } else {
            $(".text p").hide();
        }
    }
</script>


</body>

</html>